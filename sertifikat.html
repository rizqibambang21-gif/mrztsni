<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sertifikat Penghargaan | Teman Belajar</title>
    <!-- Fonts -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Great+Vibes&family=Lato:wght@300;400;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="navbar.css">

    <!-- PDF Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            background-color: #f0f2f5;
            font-family: 'Lato', sans-serif;
            margin: 0;
            /* padding handled by navbar.css */
            min-height: 100vh;
        }



        .page-container {
            margin-top: 50px;
            margin-bottom: 50px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        /* Desain Sertifikat */
        .sertifikat-wrapper {
            width: 1123px;
            height: 794px;
            background-color: #fff;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transform-origin: top center;
            margin-bottom: 20px;
        }

        .border-pattern {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 2px solid #D4AF37;
            padding: 5px;
        }

        .inner-border {
            border: 10px solid #2c3e50;
            height: 100%;
            box-sizing: border-box;
            position: relative;
            background: radial-gradient(circle, rgba(255, 255, 255, 1) 40%, rgba(245, 245, 245, 1) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .corner {
            width: 40px;
            height: 40px;
            position: absolute;
            border: 4px solid #D4AF37;
            z-index: 2;
        }

        .tl {
            top: 20px;
            left: 20px;
            border-right: none;
            border-bottom: none;
        }

        .tr {
            top: 20px;
            right: 20px;
            border-left: none;
            border-bottom: none;
        }

        .bl {
            bottom: 20px;
            left: 20px;
            border-right: none;
            border-top: none;
        }

        .br {
            bottom: 20px;
            right: 20px;
            border-left: none;
            border-top: none;
        }

        .header-logo {
            font-size: 50px;
            color: #D4AF37;
            margin-bottom: 10px;
        }

        .cert-title {
            font-family: 'Cinzel', serif;
            font-size: 48px;
            color: #2c3e50;
            letter-spacing: 4px;
            margin: 10px 0;
            text-transform: uppercase;
            border-bottom: 2px solid #D4AF37;
            padding-bottom: 10px;
            display: inline-block;
        }

        .cert-subtitle {
            font-family: 'Lato', sans-serif;
            font-size: 18px;
            color: #718096;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .recipient-name {
            font-family: 'Great Vibes', cursive;
            font-size: 82px;
            color: #D4AF37;
            margin: 20px 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }

        .cert-body {
            font-family: 'Lato', sans-serif;
            font-size: 20px;
            color: #4a5568;
            max-width: 80%;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: center;
        }

        .cert-details {
            display: flex;
            gap: 40px;
            margin-bottom: 20px;
            font-size: 18px;
            color: #2d3748;
            background: #edf2f7;
            padding: 10px 30px;
            border-radius: 50px;
            border: 1px solid #cbd5e0;
        }

        .cert-footer {
            width: 80%;
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-family: 'Cinzel', serif;
        }

        .signature-block {
            text-align: center;
            width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .signature-title {
            font-size: 16px;
            font-weight: bold;
            color: #2d3748;
            border-top: 1px solid #2d3748;
            padding-top: 10px;
            width: 100%;
            margin-top: 5px;
            text-transform: uppercase;
        }

        .signature-img {
            font-family: 'Great Vibes', cursive;
            font-size: 32px;
            color: #2b6cb0;
            margin-bottom: 5px;
            height: auto;
            line-height: 1.3;
            white-space: nowrap;
        }

        .btn-download {
            background: linear-gradient(90deg, #D4AF37 0%, #b8860b 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            margin-top: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Responsif Layar */
        /* Responsif Layar - Handled by JS for Scale, but we adjust container here */
        @media (max-width: 600px) {
            .page-container {
                margin: 10px auto 40px auto;
                padding: 10px;
                overflow-x: hidden;
                width: 100%;
            }

            .btn-download {
                width: 100%;
                max-width: 320px;
                padding: 12px 20px;
                font-size: 16px;
                margin-top: 20px;
                justify-content: center;
            }
        }

        #sertifikat-target {
            display: none;
        }

        .fade-in-content {
            display: block !important;
            animation: textFadeIn 1s forwards;
        }

        @keyframes textFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>
    <!-- Navbar (Generated by navbar.js) -->
    <script src="navbar.js"></script>

    <div class="page-container">
        <div class="sertifikat-wrapper" id="sertifikat-target">
            <div class="border-pattern">
                <div class="corner tl"></div>
                <div class="corner tr"></div>
                <div class="corner bl"></div>
                <div class="corner br"></div>
                <div class="inner-border">
                    <div class="header-logo"><i class="fas fa-award"></i></div>
                    <div class="cert-title">SERTIFIKAT PENGHARGAAN</div>
                    <div class="cert-subtitle">Diberikan dengan Bangga Kepada</div>
                    <div class="recipient-name" id="nama-sertifikat">Nama Siswa</div>
                    <div class="cert-body">Selamat atas kelulusan dan dedikasi yang sangat baik dalam
                        menyelesaikan<br><strong>Quiz Evaluasi Materi Keamanan Data</strong><br>pada platform
                        pembelajaran Teman Belajar.</div>
                    <div class="cert-details">
                        <span><i class="fas fa-star" style="color:#D4AF37"></i> Nilai: <strong
                                id="nilai-sertifikat">0</strong></span>
                        <span><i class="fas fa-users" style="color:#2b6cb0"></i> Kelas: <strong
                                id="kelas-sertifikat">-</strong></span>
                        <span><i class="fas fa-calendar" style="color:#718096"></i> <strong
                                id="tanggal-sertifikat">2024</strong></span>
                    </div>
                    <div class="cert-attribution"
                        style="margin-bottom: 20px; text-align: center; font-family: 'Lato', sans-serif;">
                        <div style="font-size: 14px; color: #718096; margin-bottom: 5px;">Mahasiswa Institut Pendidikan
                            Indonesia:</div>
                        <div style="font-size: 16px; font-weight: bold; color: #4a5568;">Rizqi T, Dharisman, Hilmy</div>
                    </div>
                    <div class="cert-footer">
                        <div class="signature-block">
                            <div class="signature-img">Dian Rahadian, M.Pd.</div>
                            <div class="signature-title">Dosen Pengampu</div>
                        </div>
                        <div class="signature-block">
                            <div class="signature-img">Institut Pendidikan Indonesia</div>
                            <div class="signature-title">Pihak Sekolah</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn-download" onclick="downloadPDF()" style="display:none;" id="btn-download"><i
                class="fas fa-download"></i> Unduh Sertifikat (PDF)</button>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBaFa2_d4almWd1wBlmPdzv9aGOa0e0m3A", authDomain: "daftarhadit-dfa3a.firebaseapp.com", projectId: "daftarhadit-dfa3a", storageBucket: "daftarhadit-dfa3a.firebasestorage.app", messagingSenderId: "438675023798", appId: "1:438675023798:web:3afc376cd435f0154fc317", measurementId: "G-XCNLPJSS57" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(); const auth = firebase.auth();

        auth.onAuthStateChanged(async user => {
            if (user) {
                const doc = await db.collection('quiz_results').doc(user.uid).get();
                if (doc.exists && doc.data().skor >= 12) {
                    const d = doc.data();
                    document.getElementById('nama-sertifikat').textContent = d.nama || 'Nama';
                    document.getElementById('kelas-sertifikat').textContent = d.kelas || '-';
                    document.getElementById('nilai-sertifikat').textContent = d.nilai || '0';
                    let dt = new Date(); if (d.tanggal && d.tanggal.toDate) dt = d.tanggal.toDate();
                    document.getElementById('tanggal-sertifikat').textContent = dt.toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' });

                    document.getElementById('sertifikat-target').classList.add('fade-in-content');
                    document.getElementById('btn-download').style.display = 'block';
                    resizeCertificate();
                } else { Swal.fire('Gagal', 'Belum lulus atau data tidak ada.').then(() => window.location.href = 'kelas.html'); }
            }
        });

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('sertifikat-target');
            Swal.fire({ title: 'Memproses PDF...', didOpen: () => Swal.showLoading() });

            try {
                const clone = element.cloneNode(true);
                clone.id = "print-version";
                Object.assign(clone.style, {
                    display: 'block', visibility: 'visible', opacity: '1',
                    position: 'fixed', top: '0', left: '0', zIndex: '-9999',
                    width: '1123px', height: '794px',
                    margin: '0', transform: 'none', animation: 'none', transition: 'none'
                });

                document.body.appendChild(clone);
                await new Promise(r => setTimeout(r, 500));

                const canvas = await html2canvas(clone, { scale: 2, useCORS: true, backgroundColor: '#ffffff', windowWidth: 1123, windowHeight: 794 });
                document.body.removeChild(clone);

                const pdf = new jsPDF('l', 'mm', 'a4');
                pdf.addImage(canvas.toDataURL('image/jpeg', 1.0), 'JPEG', 0, 0, 297, 210);
                pdf.save('Sertifikat-TemanBelajar.pdf');
                Swal.close();
            } catch (e) { console.error(e); Swal.fire('Gagal', 'Gagal generate PDF', 'error'); }
        }

        function resizeCertificate() {
            const w = document.querySelector('.sertifikat-wrapper');
            const container = document.querySelector('.page-container');
            if (!w || !container) return;

            // Hitung scale berdasarkan lebar layar vs lebar asli sertifikat (1123px)
            // Kurangi padding/margin dari window width (misal 40px)
            const availableWidth = window.innerWidth - 30;
            const scale = Math.min(1, availableWidth / 1123);

            w.style.transform = `scale(${scale})`;

            // Masalah transform scale adalah elemen tetap memakan space/layout size ASLI (1123x794)
            // Jadi kita harus adjust margin negatif atau height container

            const originalHeight = 794;
            const originalWidth = 1123;

            // Tinggi 'visual' setelah dis-scale
            const scaledHeight = originalHeight * scale;
            const scaledWidth = originalWidth * scale;

            // Space kosong yang ditinggalkan oleh scale (karena transform origin top center)
            const heightDiff = originalHeight - scaledHeight;

            // Kita tarik margin bawah ke atas sebesar selisih
            w.style.marginBottom = `-${heightDiff}px`;

            // Untuk memastikan tidak overflow horizontal di mobile
            // Transform scale tidak mengubah layout width, jadi wrapper parent mungkin perlu overflow hidden
            // atau kita set width wrapper secara eksplisit
        }

        function logout() {
            auth.signOut().then(() => {
                localStorage.removeItem('isLoggedIn');
                window.location.href = "home.html";
            });
        }

        // Call on load and resize
        window.addEventListener('resize', resizeCertificate);
        document.addEventListener('DOMContentLoaded', resizeCertificate);
    </script>
</body>

</html>